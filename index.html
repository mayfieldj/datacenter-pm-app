/* ----- Submit new task ----- */
document.getElementById('submitTask').addEventListener('click', () => {
    const title = document.getElementById('taskTitle').value.trim();
    if (!title) {
        alert('Title is required');
        return;
    }

    /* ---- Collect subscribers from the chips ---- */
    const subscriberChips = document.querySelectorAll('#subscribersInput .chip');
    const subscribers = Array.from(subscriberChips).map(chip => {
        // The name is the text node inside the chip, before the Ã—
        return chip.firstChild.textContent.trim();
    });

    const newTask = {
        id: ++taskCounter,
        title,
        description: document.getElementById('taskDesc').value,
        due: document.getElementById('taskDue').value,
        priority: document.getElementById('taskPriority').value,
        category: document.getElementById('taskCategory').value,
        owner: document.getElementById('taskOwner').value,
        subscribers,
        starred: false,
        comments: []          // initialise comment thread
    };

    tasks.push(newTask);
    persist();
    renderTaskList();                     // refresh current view
    document.getElementById('addTaskForm').classList.add('hidden');
    clearAddTaskForm();
});
