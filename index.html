<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Center Project Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .accordion-content { display: none; }
        .accordion-content.active { display: block; }
        .modal { display: none; }
        .modal.active { display: block; }
    </style>
</head>
<body class="bg-gray-100 font-sans">
    <div class="container mx-auto p-4 max-w-4xl relative">
        <h1 class="text-3xl font-bold text-center mb-6">Data Center Project Management Tool</h1>
        
        <!-- View Dropdown -->
        <select id="viewSelect" class="absolute top-4 right-4 p-2 border rounded bg-white shadow">
            <option value="main">Main Tasks</option>
            <option value="history">Project History</option>
            <option value="archived">Archived Tasks</option>
            <option value="deleted">Deleted Tasks</option>
        </select>

        <!-- Main Tasks Section -->
        <div id="mainSection" class="space-y-4">
            <p class="text-gray-600">Click a category to expand and manage sub-tasks. Tasks are saved automatically.</p>
            
            <!-- Assignee Filter -->
            <div class="bg-white p-4 border rounded shadow">
                <label class="block text-sm font-medium text-gray-700 mb-2">Filter by Assignee</label>
                <select id="assigneeFilter" class="w-full p-2 border rounded mb-2">
                    <option value="all">All Tasks</option>
                    <!-- Dynamic options will be added here -->
                </select>
                <div class="flex space-x-2 mt-2">
                    <input type="text" id="newAssignee" placeholder="Add new assignee (e.g., John Doe)" class="flex-1 p-2 border rounded">
                    <button id="addAssigneeBtn" class="p-2 bg-green-500 text-white rounded hover:bg-green-600">Add</button>
                </div>
            </div>
            
            <!-- Filtered Tasks Display (hidden by default) -->
            <div id="filteredTasks" class="hidden space-y-4"></div>
            
            <!-- Categories (shown when no filter) -->
            <div id="categoriesContainer" class="space-y-4">
                <!-- Categories will be dynamically inserted here -->
            </div>
        </div>

        <!-- Project History Section -->
        <div id="historySection" class="hidden space-y-4">
            <p class="text-gray-600">All tasks added, listed chronologically with timestamps.</p>
            <ul id="historyList" class="list-disc pl-5 space-y-2"></ul>
        </div>

        <!-- Archived Tasks Section -->
        <div id="archivedSection" class="hidden space-y-4">
            <p class="text-gray-600">Archived tasks, listed with details.</p>
            <ul id="archivedList" class="space-y-4"></ul>
        </div>

        <!-- Deleted Tasks Section -->
        <div id="deletedSection" class="hidden space-y-4">
            <p class="text-gray-600">Deleted tasks, listed with details (for reference).</p>
            <ul id="deletedList" class="space-y-4"></ul>
        </div>

        <!-- Edit Task Modal -->
        <div id="editModal" class="modal fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center">
            <div class="bg-white p-6 rounded shadow-lg w-full max-w-md">
                <h3 class="text-lg font-bold mb-4">Edit Task</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Task Title</label>
                        <input type="text" id="editTitle" class="w-full p-2 border rounded mt-1">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Task Description</label>
                        <textarea id="editDesc" rows="4" class="w-full p-2 border rounded mt-1"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Due Date</label>
                        <input type="date" id="editDue" class="w-full p-2 border rounded mt-1">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Priority</label>
                        <select id="editPriority" class="w-full p-2 border rounded mt-1">
                            <option value="low">Low (Yellow)</option>
                            <option value="mid">Mid (Orange)</option>
                            <option value="high">High (Red)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Assignee</label>
                        <input type="text" id="editAssignee" value="Josh Mayfield" class="w-full p-2 border rounded mt-1">
                    </div>
                    <div class="flex space-x-2">
                        <button id="saveEditBtn" class="flex-1 p-2 bg-blue-500 text-white rounded hover:bg-blue-600">Save</button>
                        <button id="cancelEditBtn" class="flex-1 p-2 bg-gray-300 text-gray-800 rounded hover:bg-gray-400">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Categories
        const categories = [
            "Planning & Scheduling",
            "Financial & Reporting",
            "Procurement & Contracts",
            "Design & Coordination",
            "Compliance & Permits"
        ];

        // Load data from localStorage or initialize
        let tasks = JSON.parse(localStorage.getItem('tasks')) || categories.reduce((acc, cat) => ({ ...acc, [cat]: [] }), {});
        let history = JSON.parse(localStorage.getItem('history')) || [];
        let archived = JSON.parse(localStorage.getItem('archived')) || [];
        let deleted = JSON.parse(localStorage.getItem('deleted')) || [];
        let assignees = JSON.parse(localStorage.getItem('assignees')) || ['Josh Mayfield', 'Clarke Hurd'];

        // Function to save data to localStorage
        function saveData() {
            localStorage.setItem('tasks', JSON.stringify(tasks));
            localStorage.setItem('history', JSON.stringify(history));
            localStorage.setItem('archived', JSON.stringify(archived));
            localStorage.setItem('deleted', JSON.stringify(deleted));
            localStorage.setItem('assignees', JSON.stringify(assignees));
        }

        // Function to add a task
        function addTask(category) {
            const title = document.getElementById(`${category.replace(/\s+/g, '')}_title`).value.trim();
            const description = document.getElementById(`${category.replace(/\s+/g, '')}_desc`).value.trim();
            const dueDate = document.getElementById(`${category.replace(/\s+/g, '')}_due`).value;
            const priority = document.getElementById(`${category.replace(/\s+/g, '')}_priority`).value;
            const assignee = document.getElementById(`${category.replace(/\s+/g, '')}_assignee`).value.trim() || 'Josh Mayfield';

            if (title) {
                if (!assignees.includes(assignee)) {
                    assignees.push(assignee);
                    renderAssigneeFilter();
                }
                const task = { title, description, dueDate, priority, assignee, comments: [] };
                tasks[category].push(task);
                const timestamp = new Date().toLocaleString('en-US', { year: 'numeric', month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' });
                history.push(`${timestamp} - ${category}: ${title} (Assigned to ${assignee}, Due: ${dueDate || 'None'}, Priority: ${priority.toUpperCase()})`);
                saveData();
                renderTasks();
                renderHistory();
            }
        }

        // Function to add a comment
        function addComment(category, index) {
            const commentInput = document.getElementById(`comment_${category.replace(/\s+/g, '')}_${index}`);
            const commentText = commentInput.value.trim();
            if (commentText) {
                const timestamp = new Date().toLocaleString('en-US', { year: 'numeric', month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' });
                tasks[category][index].comments.push({ text: commentText, timestamp });
                history.push(`${timestamp} - ${category}: Added comment to '${tasks[category][index].title}'`);
                commentInput.value = '';
                saveData();
                renderTasks();
                renderHistory();
            }
        }

        // Function to edit a task
        function editTask(category, index) {
            const task = tasks[category][index];
            document.getElementById('editTitle').value = task.title;
            document.getElementById('editDesc').value = task.description || '';
            document.getElementById('editDue').value = task.dueDate || '';
            document.getElementById('editPriority').value = task.priority;
            document.getElementById('editAssignee').value = task.assignee;
            document.getElementById('editModal').classList.add('active');

            document.getElementById('saveEditBtn').onclick = () => {
                const newTitle = document.getElementById('editTitle').value.trim();
                const newDesc = document.getElementById('editDesc').value.trim();
                const newDue = document.getElementById('editDue').value;
                const newPriority = document.getElementById('editPriority').value;
                const newAssignee = document.getElementById('editAssignee').value.trim() || 'Josh Mayfield';

                if (newTitle) {
                    if (!assignees.includes(newAssignee)) {
                        assignees.push(newAssignee);
                        renderAssigneeFilter();
                    }
                    tasks[category][index] = {
                        title: newTitle,
                        description: newDesc,
                        dueDate: newDue,
                        priority: newPriority,
                        assignee: newAssignee,
                        comments: tasks[category][index].comments
                    };
                    const timestamp = new Date().toLocaleString('en-US', { year: 'numeric', month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit' });
                    history.push(`${timestamp} - ${category}: Edited '${newTitle}'`);
                    saveData();
                    renderTasks();
                    renderHistory();
                    document.getElementById('editModal').classList.remove('active');
                }
            };
        }

        // Function to archive a task
        function archiveTask(category, index) {
            const task = tasks[category].splice(index, 1)[0];
            archived.push({ ...task, category });
            saveData();
            renderTasks();
            renderArchived();
        }

        // Function to delete a task
        function deleteTask(category, index) {
            const task = tasks[category].splice(index, 1)[0];
            deleted.push({ ...task, category });
            saveData();
            renderTasks();
            renderDeleted();
        }

        // Function to render assignee filter options
        function renderAssigneeFilter() {
            const filterSelect = document.getElementById('assigneeFilter');
            filterSelect.innerHTML = '<option value="all">All Tasks</option>';
            assignees.forEach(assignee => {
                const option = document.createElement('option');
                option.value = assignee;
                option.textContent = assignee === 'Josh Mayfield' ? 'My Tasks (Josh Mayfield)' : `${assignee} Tasks`;
                filterSelect.appendChild(option);
            });
            saveData();
        }

        // Function to add new assignee
        function addNewAssignee() {
            const newAssigneeInput = document.getElementById('newAssignee');
            const newName = newAssigneeInput.value.trim();
            if (newName && !assignees.includes(newName)) {
                assignees.push(newName);
                renderAssigneeFilter();
                newAssigneeInput.value = '';
            }
        }

        // Function to render tasks (with filter)
        function renderTasks() {
            const categoriesContainer = document.getElementById('categoriesContainer');
            const filteredTasksDiv = document.getElementById('filteredTasks');
            const selectedAssignee = document.getElementById('assigneeFilter').value;

            if (selectedAssignee === 'all') {
                categoriesContainer.classList.remove('hidden');
                filteredTasksDiv.classList.add('hidden');
                categoriesContainer.innerHTML = '';
                categories.forEach(category => {
                    const div = document.createElement('div');
                    div.className = 'border rounded-lg bg-white shadow';
                    const safeCat = category.replace(/\s+/g, '');
                    div.innerHTML = `
                        <button class="w-full text-left p-4 font-semibold text-lg bg-gray-50 hover:bg-gray-100">${category}</button>
                        <div class="accordion-content p-4">
                            <div class="space-y-4 mb-4">
                                ${tasks[category].map((task, idx) => `
                                    <div class="border p-3 rounded bg-gray-50">
                                        <div class="flex justify-between items-center">
                                            <h4 class="font-bold">${task.title}</h4>
                                            <div>
                                                <button class="text-blue-500 hover:underline mr-2" onclick="editTask('${category}', ${idx})">Edit</button>
                                                <button class="text-blue-500 hover:underline mr-2" onclick="document.getElementById('comment_${safeCat}_${idx}').classList.toggle('hidden')">Comment</button>
                                                <button class="text-blue-500 hover:underline mr-2" onclick="archiveTask('${category}', ${idx})">Archive</button>
                                                <button class="text-red-500 hover:underline" onclick="deleteTask('${category}', ${idx})">Delete</button>
                                            </div>
                                        </div>
                                        <p class="text-sm text-gray-600">Description: ${task.description || 'None'}</p>
                                        <p class="text-sm text-gray-600">Due: ${task.dueDate || 'None'}</p>
                                        <p class="text-sm text-gray-600">Assignee: ${task.assignee}</p>
                                        <span class="px-2 py-1 rounded text-white text-xs" style="background-color: ${task.priority === 'low' ? '#fbbf24' : task.priority === 'mid' ? '#f97316' : '#ef4444'};">${task.priority.toUpperCase()}</span>
                                        ${task.comments.length ? `
                                            <div class="mt-2">
                                                <p class="text-sm font-medium text-gray-700">Comments:</p>
                                                <ul class="list-disc pl-5 text-sm text-gray-600">
                                                    ${task.comments.map(comment => `<li>${comment.timestamp}: ${comment.text}</li>`).join('')}
                                                </ul>
                                            </div>
                                        ` : ''}
                                        <div id="comment_${safeCat}_${idx}" class="hidden mt-2">
                                            <textarea class="w-full p-2 border rounded" placeholder="Add a comment"></textarea>
                                            <button class="mt-1 p-2 bg-blue-500 text-white rounded hover:bg-blue-600" onclick="addComment('${category}', ${idx})">Submit Comment</button>
                                        </div>
                                    </div>
                                `).join('') || '<p>No sub-tasks added yet.</p>'}
                            </div>
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Task Title</label>
                                    <input type="text" id="${safeCat}_title" placeholder="Enter task title" class="w-full p-2 border rounded mt-1">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Task Description</label>
                                    <textarea id="${safeCat}_desc" rows="4" placeholder="Enter task description" class="w-full p-2 border rounded mt-1"></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Due Date</label>
                                    <input type="date" id="${safeCat}_due" class="w-full p-2 border rounded mt-1">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Priority</label>
                                    <select id="${safeCat}_priority" class="w-full p-2 border rounded mt-1">
                                        <option value="low">Low (Yellow)</option>
                                        <option value="mid">Mid (Orange)</option>
                                        <option value="high">High (Red)</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700">Assignee</label>
                                    <input type="text" id="${safeCat}_assignee" placeholder="Enter assignee name" value="Josh Mayfield" class="w-full p-2 border rounded mt-1">
                                </div>
                                <button class="w-full p-2 bg-blue-500 text-white rounded hover:bg-blue-600" onclick="addTask('${category}')">Add Task</button>
                            </div>
                        </div>
                    `;
                    categoriesContainer.appendChild(div);
                });

                // Add accordion functionality
                document.querySelectorAll('.border button').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const content = btn.nextElementSibling;
                        const isActive = content.classList.contains('active');
                        document.querySelectorAll('.accordion-content').forEach(c => c.classList.remove('active'));
                        if (!isActive) content.classList.add('active');
                    });
                });
            } else {
                categoriesContainer.classList.add('hidden');
                filteredTasksDiv.classList.remove('hidden');
                filteredTasksDiv.innerHTML = `<h3 class="text-xl font-bold mb-4">Tasks for ${selectedAssignee}</h3>`;
                let hasTasks = false;
                categories.forEach(category => {
                    const filtered = tasks[category].filter(task => task.assignee === selectedAssignee);
                    if (filtered.length > 0) {
                        hasTasks = true;
                        const catDiv = document.createElement('div');
                        catDiv.innerHTML = `<h4 class="font-semibold text-lg mb-2">${category}</h4>`;
                        const taskList = filtered.map((task, idx) => `
                            <div class="border p-3 rounded bg-gray-50 mb-2">
                                <div class="flex justify-between items-center">
                                    <h5 class="font-bold">${task.title}</h5>
                                    <div>
                                        <button class="text-blue-500 hover:underline mr-2" onclick="editTask('${category}', ${tasks[category].indexOf(task)})">Edit</button>
                                        <button class="text-blue-500 hover:underline mr-2" onclick="document.getElementById('comment_${category.replace(/\s+/g, '')}_${tasks[category].indexOf(task)}').classList.toggle('hidden')">Comment</button>
                                        <button class="text-blue-500 hover:underline mr-2" onclick="archiveTask('${category}', ${tasks[category].indexOf(task)})">Archive</button>
                                        <button class="text-red-500 hover:underline" onclick="deleteTask('${category}', ${tasks[category].indexOf(task)})">Delete</button>
                                    </div>
                                </div>
                                <p class="text-sm text-gray-600">Description: ${task.description || 'None'}</p>
                                <p class="text-sm text-gray-600">Due: ${task.dueDate || 'None'}</p>
                                <p class="text-sm text-gray-600">Assignee: ${task.assignee}</p>
                                <span class="px-2 py-1 rounded text-white text-xs" style="background-color: ${task.priority === 'low' ? '#fbbf24' : task.priority === 'mid' ? '#f97316' : '#ef4444'};">${task.priority.toUpperCase()}</span>
                                ${task.comments.length ? `
                                    <div class="mt-2">
                                        <p class="text-sm font-medium text-gray-700">Comments:</p>
                                        <ul class="list-disc pl-5 text-sm text-gray-600">
                                            ${task.comments.map(comment => `<li>${comment.timestamp}: ${comment.text}</li>`).join('')}
                                        </ul>
                                    </div>
                                ` : ''}
                                <div id="comment_${category.replace(/\s+/g, '')}_${tasks[category].indexOf(task)}" class="hidden mt-2">
                                    <textarea class="w-full p-2 border rounded" placeholder="Add a comment"></textarea>
                                    <button class="mt-1 p-2 bg-blue-500 text-white rounded hover:bg-blue-600" onclick="addComment('${category}', ${tasks[category].indexOf(task)})">Submit Comment</button>
                                </div>
                            </div>
                        `).join('');
                        catDiv.innerHTML += taskList;
                        filteredTasksDiv.appendChild(catDiv);
                    }
                });
                if (!hasTasks) {
                    filteredTasksDiv.innerHTML += '<p>No tasks for this assignee.</p>';
                }
            }
        }

        // Function to render history
        function renderHistory() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = history.length ? history.map(entry => `<li>${entry}</li>`).join('') : '<li>No history yet. Add tasks on the Main Tasks view.</li>';
        }

        // Function to render archived
        function renderArchived() {
            const archivedList = document.getElementById('archivedList');
            archivedList.innerHTML = archived.length ? archived.map(task => `
                <li class="border p-3 rounded bg-gray-50">
                    <h4 class="font-bold">${task.title} (${task.category})</h4>
                    <p class="text-sm text-gray-600">Description: ${task.description || 'None'}</p>
                    <p class="text-sm text-gray-600">Due: ${task.dueDate || 'None'}</p>
                    <p class="text-sm text-gray-600">Assignee: ${task.assignee}</p>
                    <span class="px-2 py-1 rounded text-white text-xs" style="background-color: ${task.priority === 'low' ? '#fbbf24' : task.priority === 'mid' ? '#f97316' : '#ef4444'};">${task.priority.toUpperCase()}</span>
                    ${task.comments.length ? `
                        <div class="mt-2">
                            <p class="text-sm font-medium text-gray-700">Comments:</p>
                            <ul class="list-disc pl-5 text-sm text-gray-600">
                                ${task.comments.map(comment => `<li>${comment.timestamp}: ${comment.text}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}
                </li>
            `).join('') : '<li>No archived tasks yet.</li>';
        }

        // Function to render deleted
        function renderDeleted() {
            const deletedList = document.getElementById('deletedList');
            deletedList.innerHTML = deleted.length ? deleted.map(task => `
                <li class="border p-3 rounded bg-gray-50">
                    <h4 class="font-bold">${task.title} (${task.category})</h4>
                    <p class="text-sm text-gray-600">Description: ${task.description || 'None'}</p>
                    <p class="text-sm text-gray-600">Due: ${task.dueDate || 'None'}</p>
                    <p class="text-sm text-gray-600">Assignee: ${task.assignee}</p>
                    <span class="px-2 py-1 rounded text-white text-xs" style="background-color: ${task.priority === 'low' ? '#fbbf24' : task.priority === 'mid' ? '#f97316' : '#ef4444'};">${task.priority.toUpperCase()}</span>
                    ${task.comments.length ? `
                        <div class="mt-2">
                            <p class="text-sm font-medium text-gray-700">Comments:</p>
                            <ul class="list-disc pl-5 text-sm text-gray-600">
                                ${task.comments.map(comment => `<li>${comment.timestamp}: ${comment.text}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}
                </li>
            `).join('') : '<li>No deleted tasks yet.</li>';
        }

        // Assignee filter listener
        document.getElementById('assigneeFilter').addEventListener('change', renderTasks);

        // Add assignee button listener
        document.getElementById('addAssigneeBtn').addEventListener('click', addNewAssignee);

        // Cancel edit button listener
        document.getElementById('cancelEditBtn').addEventListener('click', () => {
            document.getElementById('editModal').classList.remove('active');
        });

        // View switcher
        document.getElementById('viewSelect').addEventListener('change', (e) => {
            const sections = ['mainSection', 'historySection', 'archivedSection', 'deletedSection'];
            sections.forEach(sec => document.getElementById(sec).classList.add('hidden'));
            document.getElementById(`${e.target.value}Section`).classList.remove('hidden');
        });

        // Initial render
        renderAssigneeFilter();
        renderTasks();
        renderHistory();
        renderArchived();
        renderDeleted();

        // Set default view to main
        document.getElementById('viewSelect').value = 'main';
        document.getElementById('mainSection').classList.remove('hidden');
    </script>
</body>
</html>
</body>
</html>
